<div class="fan-zone-page fade-in">
    <div class="container">
        <h1 class="text-center section-title fade-in-up">ZONA FAN SP BASKET</h1>
        <p class="text-center mb-5 fade-in-up">Tu espacio exclusivo. Juega, participa y gana.</p>

        <!-- AUTH LOCK -->
        <div *ngIf="!isLoggedIn" class="locked-overlay fade-in">
            <div class="lock-content">
                <span class="lock-icon">üîí</span>
                <h2>Acceso Solo para Fans</h2>
                <p>Reg√≠strate para competir en el SP Runner, votar en la Quiniela y coleccionar puntos.</p>
                <a routerLink="/login" class="btn btn-primary btn-lg mt-3">ENTRAR AL CLUB</a>
            </div>
        </div>

        <div class="fan-dashboard" [class.blurred]="!isLoggedIn">

            <!-- LAYOUT GRID -->
            <div class="dashboard-grid">

                <!-- 1. SP RUNNER GAME (Featured) -->
                <div class="card-widget runner-widget span-col-2">
                    <div class="widget-header">
                        <span class="widget-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                        <h3>SP COURT RUN</h3>
                        <span class="badge-new">NUEVO</span>
                    </div>
                    <div class="widget-body text-center">
                        <div *ngIf="activeTab !== 'runner'" class="runner-preview">
                            <p>¬°Corre por la pista, esquiva defensas y bate el r√©cord!</p>
                            <div class="high-score-display">R√©cord: {{ highScoreRunner }}</div>
                            <button class="btn btn-primary btn-play pulse" (click)="showGame('runner')">JUGAR
                                AHORA</button>
                        </div>

                        <!-- GAME CONTAINER -->
                        <div *ngIf="activeTab === 'runner'" class="game-viewport">
                            <canvas #runnerCanvas width="800" height="300"></canvas>
                            <button class="btn btn-outline-light btn-sm mt-2" (click)="backToDashboard()">Salir</button>
                        </div>
                    </div>
                </div>

                <!-- 2. QUINIELA SEMANAL -->
                <div class="card-widget quiniela-widget">
                    <div class="widget-header">
                        <span class="widget-icon">üìù</span>
                        <h3>La Quiniela</h3>
                    </div>
                    <div class="widget-body">
                        <p class="text-muted mb-3">Predice el resultado del pr√≥ximo partido:</p>
                        <div class="match-prediction">
                            <div class="team">
                                <img src="assets/images/logo-sp-pink.png" alt="SP" class="mini-logo">
                                <span>SP Basket</span>
                                <input type="number" [(ngModel)]="prediction.home" [disabled]="predictionSubmitted"
                                    class="score-input">
                            </div>
                            <span class="vs">VS</span>
                            <div class="team">
                                <div class="rival-icon">ü¶Å</div>
                                <span>Leones</span>
                                <input type="number" [(ngModel)]="prediction.visitor" [disabled]="predictionSubmitted"
                                    class="score-input">
                            </div>
                        </div>
                        <button *ngIf="!predictionSubmitted" class="btn btn-outline-primary btn-block mt-3"
                            (click)="submitQuiniela()">Enviar Pron√≥stico</button>
                        <div *ngIf="predictionSubmitted" class="success-msg mt-3 fade-in">
                            ‚úÖ ¬°Pron√≥stico guardado! Suerte.
                        </div>
                    </div>
                </div>

                <!-- 3. MVP POLL -->
                <div class="card-widget poll-widget">
                    <div class="widget-header">
                        <span class="widget-icon">‚≠ê</span>
                        <h3>MVP de la Semana</h3>
                    </div>
                    <div class="widget-body">
                        <div *ngIf="!mvpVoted">
                            <p class="mb-3">¬øQui√©n ha sido el mejor jugador?</p>
                            <div class="poll-options">
                                <label *ngFor="let opt of mvpOptions" class="poll-option">
                                    <input type="radio" name="mvp" [value]="opt" [(ngModel)]="selectedMvp">
                                    <span class="option-text">{{ opt }}</span>
                                </label>
                            </div>
                            <button class="btn btn-primary btn-sm mt-3" (click)="voteMvp()"
                                [disabled]="!selectedMvp">Votar MVP</button>
                        </div>
                        <div *ngIf="mvpVoted" class="poll-results fade-in">
                            <h4>Resultados:</h4>
                            <div class="result-bar-container" *ngFor="let opt of mvpOptions">
                                <span class="label">{{ opt }}</span>
                                <div class="progress">
                                    <div class="bar" [style.width.%]="opt === selectedMvp ? 60 : 15"></div>
                                </div>
                            </div>
                            <p class="text-muted mt-2 text-small">Gracias por tu voto.</p>
                        </div>
                    </div>
                </div>

                <!-- 4. MEMORY (Legacy) -->
                <!-- <div class="card-widget memory-widget"> ... maybe keep hidden or smaller ... </div> -->
                <!-- Let's put a banner for memory instead -->

                <div class="card-widget memory-widget span-col-2">
                    <div class="widget-body flex-row">
                        <div class="mem-info">
                            <h3>üß† SP Memory Challenge</h3>
                            <p>Entrena tu mente encontrando las parejas.</p>
                        </div>
                        <button class="btn btn-outline-light" disabled>Pr√≥ximamente Torneo Mensual</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>