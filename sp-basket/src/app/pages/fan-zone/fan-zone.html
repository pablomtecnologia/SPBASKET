<div class="fan-zone-page fade-in">
    <div class="container">
        <h1 class="text-center section-title fade-in-up">ZONA FAN SP BASKET</h1>
        <p class="text-center mb-5 fade-in-up">¬°Demuestra tu pasi√≥n y habilidad! Juega, compite y divi√©rtete.</p>

        <!-- AUTH CHECK -->
        <div *ngIf="!isLoggedIn" class="locked-overlay fade-in">
            <div class="lock-content">
                <span class="lock-icon">üîí</span>
                <h2>Acceso Exclusivo</h2>
                <p>Para jugar, guardar puntuaciones y aparecer en el ranking, necesitas iniciar sesi√≥n.</p>
                <a routerLink="/login" class="btn btn-primary btn-lg mt-3">INICIAR SESI√ìN / REGISTRARSE</a>
            </div>
        </div>

        <div class="fan-dashboard" [class.blurred]="!isLoggedIn">

            <!-- TABS -->
            <div class="game-tabs mb-4">
                <button class="tab-btn" [class.active]="activeTab === 'hoops'" (click)="setActiveTab('hoops')">
                    üèÄ Super Hoops
                </button>
                <button class="tab-btn" [class.active]="activeTab === 'memory'" (click)="setActiveTab('memory')">
                    üß† SP Memory
                </button>
            </div>

            <div class="main-layout grid-layout">

                <!-- GAME AREA -->
                <div class="game-area">

                    <!-- HOOPS GAME -->
                    <div *ngIf="activeTab === 'hoops'" class="game-container hoops-container">
                        <div class="game-info-bar">
                            <span>Racha: <strong class="text-neon">{{ scoreHoops }}</strong></span>
                            <span>{{ messageHoops }}</span>
                        </div>

                        <!-- Canvas Game -->
                        <div class="canvas-wrapper">
                            <canvas #hoopsCanvas width="300" height="400"></canvas>
                            <div class="instructions-overlay" *ngIf="!ball.isDragging && !ball.isThrown">
                                <small>Haz click abajo y lanza</small>
                            </div>
                        </div>

                        <button class="btn btn-primary btn-block shoot-trigger" (click)="shootSimple()">¬°LANZAR
                            AHORA!</button>
                    </div>

                    <!-- MEMORY GAME -->
                    <div *ngIf="activeTab === 'memory'" class="game-container memory-container">
                        <div class="game-info-bar">
                            <span>Movimientos: <strong>{{ moves }}</strong></span>
                            <button class="btn btn-sm btn-outline-light" (click)="resetMemoryGame()">Reset</button>
                        </div>

                        <div class="memory-grid mb-3" *ngIf="!memoryGameWon; else winner">
                            <div class="memory-card" *ngFor="let card of cards"
                                [class.flipped]="card.flipped || card.matched" (click)="flipCard(card)">
                                <div class="card-inner">
                                    <div class="card-front">
                                        <img src="assets/images/logo-sp-pink.png" alt="SP" class="card-logo">
                                    </div>
                                    <div class="card-back">{{ card.icon }}</div>
                                </div>
                            </div>
                        </div>

                        <ng-template #winner>
                            <div class="winner-box text-center fade-in">
                                <h3>üéâ ¬°VICTORIA! üéâ</h3>
                                <p>Has completado el juego en {{ moves }} movimientos.</p>
                                <p class="text-neon">Puntuaci√≥n guardada</p>
                                <button class="btn btn-primary" (click)="resetMemoryGame()">Jugar Otra Vez</button>
                            </div>
                        </ng-template>
                    </div>

                </div>

                <!-- RANKING SIDEBAR -->
                <div class="ranking-area">
                    <h3 class="ranking-title">üèÜ Top Jugadores (Mes)</h3>
                    <div class="ranking-list">
                        <div class="ranking-item" *ngFor="let r of rankings; let i = index">
                            <span class="rank-num" [class.top-3]="i < 3">#{{ i + 1 }}</span>
                            <img [src]="r.avatar || 'assets/images/default-avatar.png'" alt="Av" class="rank-avatar">
                            <div class="rank-info">
                                <span class="rank-user">{{ r.username }}</span>
                                <span class="rank-score">{{ r.best_score }} pts</span>
                            </div>
                        </div>
                        <div *ngIf="rankings.length === 0" class="text-center p-3 text-muted">
                            ¬°S√© el primero en el ranking!
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>