<div class="perfil-container">
    <div class="perfil-card">

        <!-- Header con Avatar -->
        <div class="perfil-header">
            <div class="avatar-container">
                <img *ngIf="user.avatar" [src]="user.avatar" alt="Avatar" class="avatar-img">
                <div *ngIf="!user.avatar" class="avatar-placeholder">{{ getInitials() }}</div>

                <!-- BotÃ³n de cÃ¡mara superpuesto -->
                <label class="avatar-edit-btn" [class.loading]="uploadingAvatar">
                    <input type="file" (change)="onAvatarSelected($event)" accept="image/*" hidden>
                    <span *ngIf="!uploadingAvatar">ðŸ“·</span>
                    <span *ngIf="uploadingAvatar" class="spinner-mini"></span>
                </label>
            </div>

            <h2 class="perfil-title">{{ user.nombre }} {{ user.apellidos }}</h2>
            <p class="perfil-role">
                <span class="role-badge" [ngClass]="user.rol">{{ user.rol | titlecase }}</span>
            </p>
        </div>

        <div class="messages-area">
            <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
            <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>
        </div>

        <!-- Formulario -->
        <div class="perfil-form">
            <h3 class="section-title">InformaciÃ³n Personal</h3>

            <div class="form-row">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" [(ngModel)]="user.nombre" placeholder="Nombre">
                </div>
                <div class="form-group">
                    <label>Apellidos</label>
                    <input type="text" [(ngModel)]="user.apellidos" placeholder="Apellidos">
                </div>
            </div>

            <div class="form-group">
                <label>Email <small>(Contacto)</small></label>
                <input type="email" [(ngModel)]="user.email" placeholder="email@ejemplo.com">
            </div>

            <div class="form-group">
                <label>TelÃ©fono</label>
                <input type="tel" [(ngModel)]="user.telefono" placeholder="+34 600 000 000">
            </div>

            <h3 class="section-title mt-4">Datos de Club</h3>

            <div class="form-row">
                <div class="form-group locked">
                    <label>Usuario ðŸ”’</label>
                    <input type="text" [value]="user.username" disabled title="No se puede cambiar el usuario">
                </div>
                <div class="form-group locked">
                    <label>Licencia ðŸ”’</label>
                    <input type="text" [value]="user.licencia || 'Sin licencia asignada'" disabled>
                </div>
            </div>

            <!-- Botones AcciÃ³n -->
            <div class="form-actions">
                <button class="btn-save" [disabled]="!hasChanges || loading" (click)="saveChanges()">
                    <span *ngIf="!loading">Guardar Cambios</span>
                    <span *ngIf="loading" class="spinner"></span>
                </button>
            </div>
        </div>

        <!-- SECCIÃ“N BOTÃ“N HISTORIAL -->
        <hr class="separator" style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

        <div class="historial-cta" style="text-align:center; padding: 0 30px 40px 30px;">
            <h3 style="margin-bottom:10px; color:#555; font-size:1.1rem;">Mis TrÃ¡mites</h3>
            <p style="color:#888; margin-bottom:20px; font-size:0.95rem;">
                Consulta el estado de tus reconocimientos mÃ©dicos, pagos de loterÃ­a y descarga tus facturas.
            </p>
            <button (click)="verHistorial()" class="btn-ver-historial">
                ðŸ“‚ Ver Historial de Gestiones
            </button>
        </div>

    </div>
</div>